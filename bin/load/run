#!/usr/bin/env bash

pushd `pwd` # store current dir
cd `dirname "$0"` # cd to script path
cd ../.. # cd to project root

docker-compose -f docker-compose-loadtest.yml up -d db

# echo "--- reset signal-server database..."
# curl -X POST https://coderetriever.signalboost.info/reset
# psql postgresql://postgres@localhost:5432/loadtest_receiver_signalc -c "delete from accounts; delete from identities; delete from ownidentities; delete from prekeys; delete from sessions; delete from signedprekeys;"

echo "--- starting load test simulator..."
docker-compose -f docker-compose-loadtest.yml run --entrypoint /signalboost/bin/entrypoint/simulator-run simulator

### RUN LOAD TEST

# docker-compose -f docker-compose-loadtest.yml run --entrypoint /signalboost/bin/entrypoint/app-load app

### STOP SERVICES

# echo "--- CLEANUP: stopping load test services..."
# docker-compose -f docker-compose-loadtest.yml down
# echo "--- DONE!"

popd

