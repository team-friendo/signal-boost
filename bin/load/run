#!/usr/bin/env bash

pushd `pwd` # store current dir
cd `dirname "$0"` # cd to script path
cd ../.. # cd to project root

# ordering we want:
# 1. signal server
# 2. localtunnel
# 3. signalc
# 4. everything else...

echo "--- starting load test simulator..."
# docker-compose -f docker-compose-test-load.yml up -d  signal_server redis ngrok_simulator signalboost_ngrok 2>/dev/null 1>&2
docker-compose -f docker-compose-test-load.yml up -d signalc_simulator


echo "--- starting signald for app + simulator..."

### RUN SIMULATOR

# echo "--- RUN: starting simulator"
# docker-compose -f docker-compose-test-load.yml up -d simulator

### RUN LOAD TEST

# docker-compose -f docker-compose-test-load.yml run --entrypoint /signalboost/bin/entrypoint/app-load app

### STOP SERVICES

# echo "--- CLEANUP: stopping load test services..."
# docker-compose -f docker-compose-test-load.yml down
# echo "--- DONE!"

popd
